/*! For license information please see 8cceba29.03521b69.js.LICENSE.txt */
"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6371],{3905:(t,e,n)=>{n.d(e,{Zo:()=>c,kt:()=>m});var a=n(7294);function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,a,i=function(t,e){if(null==t)return{};var n,a,i={},r=Object.keys(t);for(a=0;a<r.length;a++)n=r[a],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(a=0;a<r.length;a++)n=r[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var l=a.createContext({}),p=function(t){var e=a.useContext(l),n=e;return t&&(n="function"==typeof t?t(e):s(s({},e),t)),n},c=function(t){var e=p(t.components);return a.createElement(l.Provider,{value:e},t.children)},d={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},h=a.forwardRef((function(t,e){var n=t.components,i=t.mdxType,r=t.originalType,l=t.parentName,c=o(t,["components","mdxType","originalType","parentName"]),h=p(n),m=i,u=h["".concat(l,".").concat(m)]||h[m]||d[m]||r;return n?a.createElement(u,s(s({ref:e},c),{},{components:n})):a.createElement(u,s({ref:e},c))}));function m(t,e){var n=arguments,i=e&&e.mdxType;if("string"==typeof t||i){var r=n.length,s=new Array(r);s[0]=h;var o={};for(var l in e)hasOwnProperty.call(e,l)&&(o[l]=e[l]);o.originalType=t,o.mdxType="string"==typeof t?t:i,s[1]=o;for(var p=2;p<r;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},856:(t,e,n)=>{n.d(e,{Z:()=>r});var a=n(7294);class i{constructor(t,e){void 0===t&&(t="#termynal"),void 0===e&&(e={}),this.container="string"==typeof t?document.querySelector(t):t,this.pfx=`data-${e.prefix||"ty"}`,this.originalStartDelay=this.startDelay=e.startDelay||parseFloat(this.container.getAttribute(`${this.pfx}-startDelay`))||600,this.originalTypeDelay=this.typeDelay=e.typeDelay||parseFloat(this.container.getAttribute(`${this.pfx}-typeDelay`))||90,this.originalLineDelay=this.lineDelay=e.lineDelay||parseFloat(this.container.getAttribute(`${this.pfx}-lineDelay`))||1500,this.progressLength=e.progressLength||parseFloat(this.container.getAttribute(`${this.pfx}-progressLength`))||40,this.progressChar=e.progressChar||this.container.getAttribute(`${this.pfx}-progressChar`)||"\u2588",this.progressPercent=e.progressPercent||parseFloat(this.container.getAttribute(`${this.pfx}-progressPercent`))||100,this.cursor=e.cursor||this.container.getAttribute(`${this.pfx}-cursor`)||"\u258b",this.lineData=this.lineDataToElements(e.lineData||[]),this.loadLines(),e.noInit||this.init()}loadLines(){const t=this.generateFinish();t.style.visibility="hidden",this.container.appendChild(t),this.lines=Array.from(this.container.querySelectorAll(`[${this.pfx}]`)).concat(this.lineData);for(let n=0;n<this.lines.length;n++)this.lines[n].style.visibility="hidden",this.container.appendChild(this.lines[n]);const e=this.generateRestart();e.style.visibility="hidden",this.container.appendChild(e),this.container.setAttribute("data-termynal","")}init(){const t=getComputedStyle(this.container);this.container.style.width="0px"!==t.width?t.width:void 0,this.container.style.minHeight="0px"!==t.height?t.height:void 0,this.container.setAttribute("data-termynal",""),this.container.innerHTML="";for(let e of this.lines)e.style.visibility="visible";this.start()}async start(){this.addFinish(),await this._wait(this.startDelay);for(let t of this.lines){const e=t.getAttribute(this.pfx),n=t.getAttribute(`${this.pfx}-delay`)||this.lineDelay;"input"===e?(t.setAttribute(`${this.pfx}-cursor`,this.cursor),await this.type(t),await this._wait(n)):"progress"===e?(await this.progress(t),await this._wait(n)):(this.container.appendChild(t),await this._wait(n)),t.removeAttribute(`${this.pfx}-cursor`)}this.addRestart(),this.finishElement.style.visibility="hidden",this.lineDelay=this.originalLineDelay,this.typeDelay=this.originalTypeDelay,this.startDelay=this.originalStartDelay}generateRestart(){const t=document.createElement("a");return t.onclick=t=>{t.preventDefault(),this.container.innerHTML="",this.init()},t.href="#",t.setAttribute("data-terminal-control",""),t.innerHTML="restart \u21bb",t}generateFinish(){const t=document.createElement("a");return t.onclick=t=>{t.preventDefault(),this.lineDelay=0,this.typeDelay=0,this.startDelay=0},t.href="#",t.setAttribute("data-terminal-control",""),t.innerHTML="fast \u2192",this.finishElement=t,t}addRestart(){const t=this.generateRestart();this.container.appendChild(t)}addFinish(){const t=this.generateFinish();this.container.appendChild(t)}async type(t){const e=Array.from(t.textContent);t.textContent="",this.container.appendChild(t);for(let n of e){const e=t.getAttribute(`${this.pfx}-typeDelay`)||this.typeDelay;await this._wait(e),t.textContent+=n}}async progress(t){const e=t.getAttribute(`${this.pfx}-progressLength`)||this.progressLength,n=(t.getAttribute(`${this.pfx}-progressChar`)||this.progressChar).repeat(e),a=t.getAttribute(`${this.pfx}-progressPercent`)||this.progressPercent;t.textContent="",this.container.appendChild(t);for(let i=1;i<n.length+1;i++){await this._wait(this.typeDelay);const e=Math.round(i/n.length*100);if(t.textContent=`${n.slice(0,i)} ${e}%`,e>a)break}}_wait(t){return new Promise((e=>setTimeout(e,t)))}lineDataToElements(t){return t.map((t=>{let e=document.createElement("div");return e.innerHTML=`<span ${this._attributes(t)}>${t.value||""}</span>`,e.firstElementChild}))}_attributes(t){let e="";for(let n in t)"class"!==n?"type"===n?e+=`${this.pfx}="${t[n]}" `:"value"!==n&&(e+=`${this.pfx}-${n}="${t[n]}" `):e+=` class=${t[n]} `;return e}}class r extends a.Component{componentDidMount(){new i(this.t,{typeDelay:40,lineDelay:700})}render(){return a.createElement("div",null,a.createElement("div",{"data-terminal":!0,style:this.props.style,ref:t=>this.t=t},this.props.children))}}},35:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>p,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var a=n(7462),i=(n(7294),n(3905)),r=n(856);const s={sidebar_position:1,title:"train"},o=void 0,l={unversionedId:"reference-manual/cli/train",id:"reference-manual/cli/train",title:"train",description:"The core syntax of the train command is the following:",source:"@site/docs/reference-manual/cli/train.md",sourceDirName:"reference-manual/cli",slug:"/reference-manual/cli/train",permalink:"/classy/docs/reference-manual/cli/train",draft:!1,editUrl:"https://github.com/sunglasses-ai/classy/edit/main/docs/docs/reference-manual/cli/train.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"train"},sidebar:"tutorialSidebar",previous:{title:"Custom Evaluation Metric",permalink:"/classy/docs/getting-started/customizing-things/custom-metric"},next:{title:"predict",permalink:"/classy/docs/reference-manual/cli/predict"}},p={},c=[{value:"Visualizing your Configuration",id:"visualizing-your-configuration",level:2}],d={toc:c};function h(t){let{components:e,...s}=t;return(0,i.kt)("wrapper",(0,a.Z)({},d,s,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The core syntax of the train command is the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'classy train\n    <task>                # any in {sequence,token,sentence-pair}\n    <path-to-dataset>     # path to your dataset\n    -n <exp-name>         # name you want to give to your model\n    -d <device>           # device on which to train ("cpu" for cpu, or device number for gpu)\n    [--print]\n')),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"If a device is not provided explicitly, ",(0,i.kt)("inlineCode",{parentName:"p"},"classy")," will search and use a gpu if present, resorting otherwise to cpu.")),(0,i.kt)("p",null,"Your model and experiment data will be saved in ",(0,i.kt)("em",{parentName:"p"},"experiments/"),"<","exp-name",">",(0,i.kt)("em",{parentName:"p"},"/current-day/current-time/"),"."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"If you want to transfer your model to a different pc, the simplest way is to transfer the entire\n",(0,i.kt)("em",{parentName:"p"},"experiments/"),"<","exp-name",">",(0,i.kt)("em",{parentName:"p"},"/current-day/current-time/")," folder. However, multiple checkpoints, i.e. the model at different\nmoments in the training, might be present in the ",(0,i.kt)("em",{parentName:"p"},"checkpoints/")," folder; to speed up the transfer, you might want to\nconsider moving only one of them, for instance the best one, ",(0,i.kt)("em",{parentName:"p"},"checkpoints/best.ckpt"),".")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note")," that ",(0,i.kt)("em",{parentName:"p"},"<","path-to-dataset",">")," is a bit of a special parameter and can be either:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"a ",(0,i.kt)("strong",{parentName:"p"},"folder"),", or, actually, a ",(0,i.kt)("em",{parentName:"p"},"ML-ready")," folder: that is, it must contain a training file, named ",(0,i.kt)("em",{parentName:"p"},"train.#"),"\n(# denotes a classy supported extension), and, optionally, a validation file and a test file, ",(0,i.kt)("em",{parentName:"p"},"validation.#")," and ",(0,i.kt)("em",{parentName:"p"},"test.#"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"a ",(0,i.kt)("strong",{parentName:"p"},"file"),": classy uses the file provided to automatically generate an ML-ready folder for you, storing it in the\n",(0,i.kt)("em",{parentName:"p"},"data/")," folder inside the current experiment")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"a ",(0,i.kt)("strong",{parentName:"p"},"yaml file"),": classy reads the yaml file and infer the datasets involved in the training process from it. It should be organized as follows:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'# Optional parameter that tells classy which is your favourite format.\n# If classy has to save something, it will save it in the format you specify,\n#  using the corresponding DataDriver.\nmain_data_driver: "json"\n\n# You can specify a split using a dictionary path -> extension\n#  that tells classy the dataset involved and which DataDriver\n#  to use for each dataset.\ntrain_dataset:\n  "first-train-dataset-path.tsv": "tsv"\n  "second-train-dataset-path.json": "my-special-format"\n\n# You can also specify a split as a list of paths, and the DataDriver\n#  to use for each dataset will be inferred from the extension.\nvalidation_dataset:\n  - "fist-validation-dataset.tsv"\n  - "second-validation-dataset.tsv"\n\n# And finally, you can specify a split as single path\ntest_dataset: "test-dataset.json"\n')))),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"In both ",(0,i.kt)("em",{parentName:"p"},"folder")," and ",(0,i.kt)("em",{parentName:"p"},"yaml file")," cases, if the validation dataset is not specified, classy automatically generates it by reserving some samples\nfrom the training file: the new training and validation files are saved in the ",(0,i.kt)("em",{parentName:"p"},"data/")," folder inside the current experiment.\nThis does not hold for the test set and, if not present, classy ",(0,i.kt)("strong",{parentName:"p"},"will not")," create it.")),(0,i.kt)(r.Z,{mdxType:"ReactTermynal"},(0,i.kt)("span",{"data-ty":"input"},"classy train sequence data/sequence-dataset -n sequence-example"),(0,i.kt)("span",{"data-ty":"progress"}),(0,i.kt)("span",{"data-ty":!0},"Training completed"),(0,i.kt)("span",{"data-ty":"input"},"ls experiments"),(0,i.kt)("span",{"data-ty":!0},"sequence-sample/"),(0,i.kt)("span",{"data-ty":"input"},"tree -L 2 sequence-example"),(0,i.kt)("span",{className:"data-ty-treefix","data-ty":!0},"experiments/sequence-example/<day>/<time>/",(0,i.kt)("div",null,"\u251c\u2500\u2500 .hydra\n          \u2502   \u2514\u2500\u2500 config.yaml\n          \u251c\u2500\u2500 checkpoints\n          \u2502   \u251c\u2500\u2500 best.ckpt\n          \u2502   \u251c\u2500\u2500 epoch=00-val_loss=0.51.ckpt\n          \u2502   \u2514\u2500\u2500 last.ckpt\n          \u251c\u2500\u2500 data\n          \u2502   \u251c\u2500\u2500 train.shuffled.tsv\n          \u2502   \u2514\u2500\u2500 validation.tsv\n          \u2514\u2500\u2500 ...\n        ".split("\n").map(((t,e)=>(0,i.kt)("p",{key:e,style:{lineHeight:"1.0"}},t)))))),(0,i.kt)("p",null),(0,i.kt)("p",null,"For all CLI commands that involve using a trained model, you can use 4 ways to specify it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# the <exp-name> you used at training time (classy will search in the experiments/ folder and use the latest best.ckpt)\nclassy <cmd> sequence-example ...\n# path to model folder\nclassy <cmd> experiments/sequence-example/ ...\n# path to specific model experiment <day>/<time>\nclassy <cmd> experiments/sequence-example/<day>/<time> ...\n# path to checkpoint inside a model experiment folder\nclassy <cmd> experiments/sequence-example/<day>/<time>/checkpoints/epoch=00-val_loss=0.51.ckpt\n")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"For all CLI commands, you can execute ",(0,i.kt)("inlineCode",{parentName:"p"},"classy <command> -h")," for additional information and parameters.")),(0,i.kt)("h2",{id:"visualizing-your-configuration"},"Visualizing your Configuration"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"classy train")," has an option that lets you visualize the full materialized configuration in your terminal, showing you\nwhere each component comes from (including overridden configuration groups, overrides, profiles, etc.).\nTo print it, simply append ",(0,i.kt)("inlineCode",{parentName:"p"},"--print")," to your current ",(0,i.kt)("inlineCode",{parentName:"p"},"classy train")," command!"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Classy Train Print - Token",src:n(50).Z,width:"2416",height:"1490"})))}h.isMDXComponent=!0},50:(t,e,n)=>{n.d(e,{Z:()=>a});const a=n.p+"assets/images/classy-train-print-tok-b5a757bdb763b121178cee5774958d41.png"}}]);